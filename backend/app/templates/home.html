{% extends "base.html" %}
{% block content %}
<style>
  .home-comestibles {
    background:
      radial-gradient(circle at 6% -4%, rgba(37, 99, 235, 0.16) 0%, rgba(255, 255, 255, 0) 42%),
      radial-gradient(circle at 94% 2%, rgba(59, 130, 246, 0.18) 0%, rgba(255, 255, 255, 0) 40%),
      linear-gradient(180deg, #f8fbff 0%, #f2f8ff 100%);
  }
  .home-comestibles .odoo-header {
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(191, 219, 254, 0.92);
    border-radius: 26px;
    background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(248,251,255,0.9) 54%, rgba(239,246,255,0.9) 100%);
    box-shadow: 0 18px 42px rgba(30, 64, 175, 0.10);
    backdrop-filter: blur(4px);
    padding: 1.05rem 1.15rem 0.95rem;
  }
  .home-comestibles .odoo-header::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(105deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.46) 50%, rgba(255,255,255,0) 70%);
    transform: translateX(-120%);
    animation: comHeaderShine 5.5s ease-in-out infinite;
    pointer-events: none;
  }
  .home-comestibles .odoo-kpi {
    border: 1px solid #dbeafe;
    background: linear-gradient(180deg, #ffffff 0%, #f5f9ff 100%);
    box-shadow: 0 8px 22px rgba(30, 64, 175, 0.07);
  }
  .home-comestibles .odoo-kpi i {
    color: #1d4ed8 !important;
  }
  .home-comestibles .odoo-card {
    border: 1px solid rgba(191, 219, 254, 0.92);
    background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(247,251,255,0.95) 100%);
    box-shadow: 0 18px 38px rgba(15, 23, 42, 0.09);
    backdrop-filter: blur(4px);
  }
  .home-comestibles .row.g-4 > [class*="col-"] > a > div,
  .home-comestibles .row.g-4 > [class*="col-"] > div {
    position: relative;
    overflow: hidden;
    border-color: rgba(191, 219, 254, 0.9) !important;
    background: linear-gradient(168deg, #ffffff 0%, #f6faff 100%) !important;
    transition: transform .32s ease, box-shadow .32s ease, border-color .32s ease;
    animation: comSlideIn .52s cubic-bezier(.22,.61,.36,1) both;
  }
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(2) > a > div,
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(2) > div { animation-delay: .05s; }
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(3) > a > div,
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(3) > div { animation-delay: .1s; }
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(4) > a > div,
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(4) > div { animation-delay: .15s; }
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(5) > a > div,
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(5) > div { animation-delay: .2s; }
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(6) > a > div,
  .home-comestibles .row.g-4 > [class*="col-"]:nth-child(6) > div { animation-delay: .25s; }
  .home-comestibles .row.g-4 > [class*="col-"] > a:hover > div,
  .home-comestibles .row.g-4 > [class*="col-"] > div:hover {
    transform: translateY(-6px);
    border-color: #93c5fd !important;
    box-shadow: 0 18px 34px rgba(30, 64, 175, 0.16);
  }
  .home-comestibles .odoo-pill {
    border: 1px solid #bfdbfe;
    background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
    color: #1d4ed8;
    font-weight: 700;
  }
  .home-comestibles .odoo-pill i {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.4rem;
    height: 1.4rem;
    border-radius: 999px;
    background: linear-gradient(180deg, #eff6ff 0%, #dbeafe 100%);
    color: #2563eb;
    box-shadow: inset 0 0 0 1px rgba(191, 219, 254, 0.85);
  }
  .home-comestibles .odoo-section-title {
    color: #0f2560;
    font-weight: 700;
    letter-spacing: 0.01em;
  }
  .home-comestibles p.text-slate {
    color: #475569 !important;
  }
  .home-comestibles .nav-tabs .nav-link.active {
    color: #1d4ed8;
    border-color: #bfdbfe #bfdbfe #fff;
    background: #fff;
    box-shadow: 0 8px 16px rgba(37, 99, 235, 0.10);
  }
  @keyframes comHeaderShine {
    0% { transform: translateX(-120%); }
    100% { transform: translateX(140%); }
  }
  @keyframes comSlideIn {
    from { opacity: 0; transform: translateY(10px) translateX(8px); }
    to { opacity: 1; transform: translateY(0) translateX(0); }
  }
  @media (max-width: 991.98px) {
    .home-mobile-hero {
      border: 1px solid #dbe6f4;
      border-radius: 18px;
      padding: 0.9rem;
      background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 58%, #2563eb 100%);
      color: #fff;
      box-shadow: 0 12px 24px rgba(30, 58, 138, 0.2);
      margin-bottom: 0.9rem;
    }
    .home-mobile-hero .odoo-title {
      font-size: 1.2rem;
      color: #fff;
      margin-top: 0 !important;
    }
    .home-mobile-hero .odoo-subtitle {
      color: rgba(255, 255, 255, 0.86);
      margin-top: 0.15rem !important;
    }
    .home-mobile-hero .btn {
      border-radius: 12px;
      font-weight: 700;
    }
    .home-mobile-kpis {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.55rem;
      margin-bottom: 0.75rem;
    }
    .home-mobile-kpi {
      background: #fff;
      border: 1px solid #dbe6f4;
      border-radius: 14px;
      padding: 0.5rem 0.55rem;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
    }
    .home-mobile-kpi .label {
      font-size: 0.66rem;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      color: #5b6981;
      margin-bottom: 0.15rem;
    }
    .home-mobile-kpi .value {
      font-size: 0.9rem;
      font-weight: 700;
      color: #102a43;
    }
    .home-mobile-quick {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    .home-mobile-quick .btn {
      min-height: 44px;
      font-weight: 700;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
    }
    .home-mobile-preventas {
      background: #fff;
      border: 1px solid #dbe6f4;
      border-radius: 14px;
      padding: 0.7rem;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
      margin-bottom: 0.8rem;
    }
    .home-mobile-preventas .head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      list-style: none;
      width: 100%;
      cursor: pointer;
      margin: 0;
    }
    .home-mobile-preventas .head::-webkit-details-marker {
      display: none;
    }
    .home-mobile-preventas .caret {
      color: #1e3a8a;
      font-size: 0.75rem;
      margin-left: 0.35rem;
      transition: transform .15s ease;
    }
    .home-mobile-preventas details[open] .caret {
      transform: rotate(180deg);
    }
    .home-mobile-preventas .body {
      margin-top: 0.55rem;
    }
    .home-mobile-preventas .title {
      font-size: 0.8rem;
      font-weight: 800;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      color: #1e3a8a;
    }
    .home-mobile-preventa-row {
      border: 1px solid #e7eef9;
      border-radius: 10px;
      padding: 0.5rem;
      margin-bottom: 0.45rem;
      background: #f8fbff;
    }
    .home-mobile-preventa-row:last-child {
      margin-bottom: 0;
    }
    .home-mobile-preventa-row .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.4rem;
      margin-bottom: 0.2rem;
      font-size: 0.84rem;
      font-weight: 700;
      color: #0f172a;
    }
    .home-mobile-preventa-row .meta {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 0.2rem 0.45rem;
      font-size: 0.76rem;
      color: #44556e;
    }
    .home-mobile-preventa-row .cliente {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
  }
</style>
<div id="layout" class="min-h-screen grid lg:grid-cols-[260px_1fr] bg-surface {% if comestibles_theme_enabled %}home-comestibles{% endif %}">
  {% include "partials/sidebar.html" %}

  <main class="p-4 sm:p-6 lg:p-8 text-[18px]">
    {% set has_perms = request.state.has_permissions if request and request.state else false %}
    {% set perms = request.state.permission_names if has_perms else [] %}
    <div class="odoo-page">
      <div class="odoo-header">
        <div class="home-mobile-hero d-lg-none">
          <div class="d-flex align-items-center justify-content-between gap-2">
            <div>
              <div class="odoo-title">Centro de operaciones</div>
              {% set branding = request.state.branding if request and request.state and request.state.branding else {} %}
              <div class="odoo-subtitle">{{ branding.get("app_title", "ERP System") }}</div>
            </div>
            <button class="btn btn-light btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
              <i class="bi bi-list"></i>
              Menu
            </button>
          </div>
        </div>
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 position-relative">
          <div>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item">Panel</li>
                <li class="breadcrumb-item active" aria-current="page">Home</li>
              </ol>
            </nav>
            <div class="odoo-title mt-2">Centro de operaciones</div>
            <div class="odoo-subtitle mt-1">Gestion integral para ventas, inventario y finanzas.</div>
          </div>
          <div class="d-flex d-lg-none align-items-center gap-2 w-100">
            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
              <i class="bi bi-list"></i>
              Menu
            </button>
            <span class="text-slate text-sm">Accesos rapidos</span>
          </div>
          <div class="odoo-toolbar d-none d-lg-flex flex-column flex-sm-row gap-2 w-100 w-lg-auto">
            <a class="btn btn-primary btn-sm shadow-sm d-inline-flex align-items-center gap-2" href="/inventory">
              <i class="bi bi-box-seam"></i>
              Catalogo de productos
            </a>
            {% if not has_perms or 'menu.sales.preventas.mobile' in perms or 'menu.sales.preventas' in perms %}
            <a class="btn btn-outline-primary btn-sm shadow-sm d-inline-flex align-items-center gap-2" href="/m/preventas">
              <i class="bi bi-phone"></i>
              Nueva preventa movil
            </a>
            {% endif %}
            <a class="btn btn-outline-secondary btn-sm shadow-sm d-inline-flex align-items-center gap-2" href="/inventory/ingresos">
              <i class="bi bi-box-arrow-in-down"></i>
              Ingresos de inventario
            </a>
            <a class="btn btn-outline-secondary btn-sm shadow-sm d-inline-flex align-items-center gap-2" href="/inventory/egresos">
              <i class="bi bi-box-arrow-up"></i>
              Egresos de inventario
            </a>
          </div>
        </div>
        <div class="overflow-x-auto mt-3">
          <ul class="nav nav-tabs flex-nowrap">
          <li class="nav-item">
            <a class="nav-link active" href="/home">Panel</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/sales/ventas-caliente">Ventas en Caliente</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/reports">Informes</a>
          </li>
          </ul>
        </div>
      </div>

      <div class="odoo-kpis">
        <div class="odoo-kpi">
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate inline-flex items-center gap-2">
            <i class="bi bi-activity text-blue-600"></i>
            Estado operativo
          </div>
          <strong>Estable</strong>
        </div>
        <div class="odoo-kpi">
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate inline-flex items-center gap-2">
            <i class="bi bi-geo-alt text-emerald-600"></i>
            Sucursal activa
          </div>
          <strong>Central</strong>
        </div>
        <div class="odoo-kpi">
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate inline-flex items-center gap-2">
            <i class="bi bi-shield-check text-violet-600"></i>
            Seguridad
          </div>
          <strong>Control total</strong>
        </div>
        <div class="odoo-kpi">
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate inline-flex items-center gap-2">
            <i class="bi bi-graph-up-arrow text-rose-600"></i>
            Operaciones
          </div>
          <strong>En linea</strong>
        </div>
      </div>
      <div class="home-mobile-kpis d-lg-none">
        <div class="home-mobile-kpi">
          <div class="label">Estado</div>
          <div class="value">Estable</div>
        </div>
        <div class="home-mobile-kpi">
          <div class="label">Sucursal</div>
          <div class="value">Central</div>
        </div>
        <div class="home-mobile-kpi">
          <div class="label">Seguridad</div>
          <div class="value">Control total</div>
        </div>
        <div class="home-mobile-kpi">
          <div class="label">Operaciones</div>
          <div class="value">En linea</div>
        </div>
      </div>

      <div class="odoo-card">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3">
          <div class="odoo-section-title">Modulos principales</div>
          <span class="odoo-pill primary">
            <i class="bi bi-grid-3x3-gap"></i>
            Accesos rapidos
          </span>
        </div>
        <div class="home-mobile-quick d-lg-none">
          <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
            <i class="bi bi-layout-sidebar-inset"></i>
            Ver modulos
          </button>
          {% if not has_perms or 'menu.sales.preventas.mobile' in perms or 'menu.sales.preventas' in perms %}
          <a class="btn btn-primary btn-sm" href="/m/preventas">
            <i class="bi bi-phone"></i>
            Nueva preventa
          </a>
          {% endif %}
        </div>
        <div class="home-mobile-preventas d-lg-none">
          <details>
            <summary class="head">
              <span class="title">Mis preventas (hoy y ayer)</span>
              <span class="d-inline-flex align-items-center">
                <span class="badge text-bg-primary">{{ home_preventas|length }}</span>
                <i class="bi bi-chevron-down caret"></i>
              </span>
            </summary>
            <div class="body">
              {% if home_preventas %}
                {% for p in home_preventas %}
                <div class="home-mobile-preventa-row">
                  <div class="top">
                    <span>{{ p.numero }}</span>
                    <span class="badge {{ p.estado_class }}">{{ p.estado_label }}</span>
                  </div>
                  <div class="meta">
                    <span class="cliente">{{ p.cliente }}</span>
                    <span>{{ p.monto_label }}</span>
                    <span>{{ p.fecha_label }}</span>
                    <span></span>
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <div class="text-slate text-sm">No hay preventas recientes para tu usuario.</div>
              {% endif %}
            </div>
          </details>
        </div>
        <div class="row g-4">
          <div class="col-md-6 col-xl-4">
            <a class="text-decoration-none" href="/sales/ventas-caliente">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Ventas en Caliente</div>
                  <span class="odoo-pill primary">
                    <i class="bi bi-fire"></i>
                    Reporte
                  </span>
                </div>
                <p class="text-slate mt-2">Totales por sucursal y tendencia del mes actual.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4">
            <a class="text-decoration-none" href="/inventory/caliente">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Inventario en Caliente</div>
                  <span class="odoo-pill primary">
                    <i class="bi bi-lightning-charge"></i>
                    Stock
                  </span>
                </div>
                <p class="text-slate mt-2">Existencias en tiempo real por bodega.</p>
              </div>
            </a>
          </div>
          {% if not has_perms or 'menu.sales.preventas.mobile' in perms or 'menu.sales.preventas' in perms %}
          <div class="col-md-6 col-xl-4">
            <a class="text-decoration-none" href="/m/preventas">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Preventa movil</div>
                  <span class="odoo-pill primary">
                    <i class="bi bi-journal-richtext"></i>
                    Ventas
                  </span>
                </div>
                <p class="text-slate mt-2">Crear y enviar preventas desde telefono, con cliente y validacion de inventario.</p>
              </div>
            </a>
          </div>
          {% endif %}
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/reports">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Informes</div>
                  <span class="odoo-pill primary">
                    <i class="bi bi-bar-chart"></i>
                    Analisis
                  </span>
                </div>
                <p class="text-slate mt-2">Reportes detallados con filtros por fechas y sucursales.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/inventory">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Inventarios</div>
                  <span class="odoo-pill success">
                    <i class="bi bi-box-seam"></i>
                    Activo
                  </span>
                </div>
                <p class="text-slate mt-2">Catalogo, costos, movimientos y existencias.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/inventory/ingresos">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Ingresos</div>
                  <span class="odoo-pill primary">
                    <i class="bi bi-box-arrow-in-down"></i>
                    Flujo
                  </span>
                </div>
                <p class="text-slate mt-2">Compras locales, importaciones y ajustes.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/inventory/egresos">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Egresos</div>
                  <span class="odoo-pill">
                    <i class="bi bi-box-arrow-up"></i>
                    Salidas
                  </span>
                </div>
                <p class="text-slate mt-2">Bajas por ajustes, mermas y devoluciones.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/finance">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Finanzas</div>
                  <span class="odoo-pill">
                    <i class="bi bi-cash-stack"></i>
                    Control
                  </span>
                </div>
                <p class="text-slate mt-2">Tasas, conversiones y flujo financiero.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
              <div class="d-flex align-items-center justify-content-between">
                <div class="odoo-section-title">Contabilidad</div>
                <span class="odoo-pill">
                  <i class="bi bi-journal-text"></i>
                  Proximo
                </span>
              </div>
              <p class="text-slate mt-2">Libros contables y conciliaciones.</p>
            </div>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <a class="text-decoration-none" href="/data">
              <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="odoo-section-title">Datos maestros</div>
                  <span class="odoo-pill">
                    <i class="bi bi-cpu"></i>
                    Admin
                  </span>
                </div>
                <p class="text-slate mt-2">Usuarios, roles, bancos, formas de pago y catalogos.</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-xl-4 d-none d-lg-block">
            <div class="border border-slate-200 rounded-3xl p-4 h-100 shadow-sm bg-white">
              <div class="d-flex align-items-center justify-content-between">
                <div class="odoo-section-title">Ecommerce</div>
                <span class="odoo-pill">
                  <i class="bi bi-globe2"></i>
                  Proximo
                </span>
              </div>
              <p class="text-slate mt-2">Ventas online y catalogo digital.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="text-end text-slate text-sm mt-4">Version {{ version }}</div>
    </div>
  </main>
</div>
{% endblock %}
