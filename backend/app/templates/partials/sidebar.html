<aside data-bs-sidebar class="odoo-sidebar sidebar bg-white border-end d-none d-lg-flex flex-column">
  {% set has_perms = request.state.has_permissions if request and request.state else false %}
  {% set perms = request.state.permission_names if has_perms else [] %}
  {% set branding = request.state.branding if request and request.state and request.state.branding else {} %}
  {% set menu_links = request.state.menu_links if request and request.state and request.state.menu_links else [] %}
  <div class="p-3 border-bottom">
    <div class="d-flex align-items-center gap-2">
      <img src="{{ branding.get('logo_url', '/static/logo_hollywood.png') }}" alt="{{ branding.get('trade_name', 'ERP') }}" width="48" height="48" class="rounded-3 border border-1 border-primary-subtle" />
      <div class="sidebar-brand">
        <div class="fw-semibold text-dark">{{ branding.get("trade_name", "Empresa") }}</div>
        <div class="text-uppercase text-muted small">{{ branding.get("sidebar_subtitle", "ERP") }}</div>
      </div>
      <button data-bs-sidebar-toggle class="btn btn-sm btn-outline-secondary ms-auto" type="button" aria-label="Ocultar menu">
        <i class="bi bi-layout-sidebar-inset"></i>
      </button>
    </div>
  </div>

  <div class="px-3 pt-3">
    <div class="text-uppercase text-muted small fw-semibold">Modulos</div>
  </div>

  <div class="flex-grow-1 overflow-auto px-2 py-2">
    <nav class="nav flex-column gap-2">
      {% for item in menu_links %}
      {% set item_perm = item.perm %}
      {% set item_alt_perm = item.alt_perm %}
      {% if not has_perms or item_perm in perms or (item_alt_perm and item_alt_perm in perms) %}
      <a class="nav-link d-flex align-items-center gap-2 rounded-3 bg-white py-2 px-3" href="{{ item.href }}">
        <i class="bi {{ item.icon }} text-primary fs-5"></i>
        <span class="nav-text fw-semibold">{{ item.label }}</span>
      </a>
      {% endif %}
      {% endfor %}
    </nav>
  </div>

  <div class="border-top p-3 sidebar-user">
    <div class="badge bg-light text-primary text-uppercase mb-2">Administrador</div>
    <div class="fw-semibold text-dark">{{ user.full_name }}</div>
    <div class="text-muted small">{{ user.email }}</div>
    <a class="btn btn-sm btn-outline-secondary w-100 mt-2" href="/logout">
      <i class="bi bi-box-arrow-right"></i>
      <span class="nav-text fw-semibold">Cerrar sesion</span>
    </a>
  </div>
</aside>

<div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="mobileSidebar" aria-labelledby="mobileSidebarLabel">
  <div class="offcanvas-header border-bottom">
    <div class="d-flex align-items-center gap-2">
      <img src="{{ branding.get('logo_url', '/static/logo_hollywood.png') }}" alt="{{ branding.get('trade_name', 'ERP') }}" width="48" height="48" class="rounded-3 border border-1 border-primary-subtle" />
      <div>
        <div class="fw-semibold text-dark" id="mobileSidebarLabel">{{ branding.get("trade_name", "Empresa") }}</div>
        <div class="text-uppercase text-muted small">{{ branding.get("sidebar_subtitle", "ERP") }}</div>
      </div>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
  </div>
  <div class="offcanvas-body p-0 d-flex flex-column">
    <div class="px-3 pt-3">
      <div class="text-uppercase text-muted small fw-semibold">Modulos</div>
    </div>
    <div class="flex-grow-1 overflow-auto px-2 py-2">
      <nav class="nav flex-column gap-2">
        {% for item in menu_links %}
        {% set item_perm = item.perm %}
        {% set item_alt_perm = item.alt_perm %}
        {% if not has_perms or item_perm in perms or (item_alt_perm and item_alt_perm in perms) %}
        <a class="nav-link d-flex align-items-center gap-2 rounded-3 bg-white py-2 px-3" href="{{ item.href }}">
          <i class="bi {{ item.icon }} text-primary fs-5"></i>
          <span class="nav-text fw-semibold">{{ item.label }}</span>
        </a>
        {% endif %}
        {% endfor %}
      </nav>
    </div>
    <div class="border-top p-3">
      <div class="badge bg-light text-primary text-uppercase mb-2">Administrador</div>
      <div class="fw-semibold text-dark">{{ user.full_name }}</div>
      <div class="text-muted small">{{ user.email }}</div>
      <a class="btn btn-sm btn-outline-secondary w-100 mt-2" href="/logout">
        <i class="bi bi-box-arrow-right"></i>
        <span class="nav-text fw-semibold">Cerrar sesion</span>
      </a>
    </div>
  </div>
</div>
